# Дипломная работа "Системный администратор"

* [Задача] [ссылка]
* [Настройка виртуальной машны для развертывания работы](#Настройка виртуальной машны для развертывания работы)
    * [Запуск терраформ кода](#Запуск терраформ кода)
    * [Сайт](#Сайт)
    * [Мониторинг](#Мониторинг)
    * [Логи](#Логи)
    * [Сеть](#Сеть)
    * [Резервное копирование](#Резервное%20копирование)


## Настройка виртуальной машны для развертывания работы

* Копируем скрипт на виртуальную машину (если она подготовлена для проверки или запуска)

```bash
#!/bin/bash

echo 'Привет, это установка ansible &  terraform & добавление config файла для доступа к хостам через БАСТИОН!!'

sleep 5

sudo apt update

sudo apt -y install vim curl wget zip git

sudo add-apt-repository ppa:ansible/ansible-2.10
sudo apt -y install ansible

echo 'Подключение репозиториев'

git clone https://github.com/avo1yanskiy/dist.git
git clone https://github.com/avo1yanskiy/diplome-slin.git

#echo 'Распаковка Терраформа и копирование' (Может не работать дистрибутив для CPU M1)

#unzip ~/dist terraform_1.2.1_linux_arm64.zip

#sudo cp ~/dist/terraform /usr/local/bin
```
* Копируем файл [ссылка](https://github.com/avo1yanskiy/diplome-slin/blob/main/hosts/config) в директорию ~/.ssh/
файл будет отвечать за подключения к виртуальным машинам через машину "Бастион" через внешний IP адрес.

* Указываем источник, из которого будет устанавливаться провайдер.

Откройте файл конфигурации Terraform CLI:

```
nano ~/.terraformrc
```
Добавьте в него следующий блок:

```
provider_installation {
  network_mirror {
    url = "https://terraform-mirror.yandexcloud.net/"
    include = ["registry.terraform.io/*/*"]
  }
  direct {
    exclude = ["registry.terraform.io/*/*"]
  }
}
```
* Создаем ключ для подключения к виртуальным машинам командой ssh-keygen

## Запуск терраформ кода
* Код для создания виртуальных машин для дипломного проекта находиться в папке [ссылка](https://github.com/avo1yanskiy/diplome-slin/tree/main/virtual-machine) virtual-machine.
* В файле [ссылка](https://github.com/avo1yanskiy/diplome-slin/blob/main/virtual-machine/meta.txt) meta.txt добавляем свой ключ который мы сгенерировали для подключения к виртуальным машинам.

```
ssh-authorized-keys:
      - ssh-rsa AAAAB3Nz итд
```
* Заходим в папку virtual-machine запускаем:

*terraform init*

![alt tag](https://github.com/avo1yanskiy/diplome-slin/blob/main/image/1.png)

*terraform apply*

![alt tag](https://github.com/avo1yanskiy/diplome-slin/blob/main/image/2.png)